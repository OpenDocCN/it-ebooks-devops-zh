# åº”ç”¨: Netgear WNDR4300 åˆ· OpenWrt ğŸªœğŸ§±æ•™ç¨‹

# ç½‘ä»¶ Netgear WNDR4300 åˆ· OpenWrt ğŸªœğŸ§±æ•™ç¨‹

ç½‘ä»¶ Netgear WNDR4300 æ˜¯å¾ˆå¤šç½‘å‹æ¨èçš„å¯åˆ· OpenWRT çš„æ— çº¿è·¯ç”±å™¨ã€‚

WNDR4300 æœ‰ v1 å’Œ v2 çš„åŒºåˆ«ï¼Œç›®å‰å›½è¡Œéƒ½æ˜¯ v1 ç‰ˆæœ¬ã€‚

![å·²ç»åˆ·ä¸ŠğŸªœğŸ§±å›ºä»¶çš„ WNDR4300 è·¯ç”±å™¨ OpenWrt åå°](img/6.netgear-wndr4300-luci.png)

## ç½‘ä»¶ Netgear WNDR4300 æ— çº¿è·¯ç”±å™¨çš„ä¼˜ç‚¹

*   åˆ· OpenWrt æ–¹ä¾¿ã€‚è´­ä¹°åï¼Œç™»å½•ç®¡ç†ç•Œé¢å¯ä»¥ç›´æ¥åˆ· OpenWrt
*   WNDR4300 è‡ªå¸¦ä¸æ­» ubootï¼Œåˆ·æœºæ¯”è¾ƒå®‰å…¨
*   ç¡¬ä»¶é…ç½®é«˜ã€‚æ®ç½‘å‹æµ‹è¯•ï¼ŒåŒæ—¶æ¥å…¥ 40 å°æœºå™¨éƒ½æ²¡æœ‰é—®é¢˜
*   æ— çº¿ä¿¡å·å¼ºã€‚150 å¹³æ–¹çš„å®¤å†…åŸºæœ¬æ— ä¿¡å·æ­»è§’
*   æœ‰ä¸€ä¸ª USB æ¥å£ï¼Œå¯ä»¥æŒ‚è½½è®¾å¤‡

## ç½‘ä»¶ Netgear WNDR4300 å›½è¡Œç¡¬ä»¶ä¿¡æ¯

åƒå…†åŒé¢‘ï¼Œ300+450Mbps çš„æ— çº¿è¿æ¥ï¼Œ2.4G å’Œ 5G æ— çº¿ä¿¡å·å¯ä»¥åŒæ—¶ä½¿ç”¨ï¼Œ1000Mbps æœ‰çº¿ç«¯å£ï¼Œå†…ç½® 5 å¤©çº¿ï¼ˆä¸¤æ ¹ 5G+ä¸‰æ ¹ 2.4Gï¼‰ï¼Œé‡‡ç”¨ Atheros AR9344 å¤„ç†å™¨ï¼Œé¢‘ç‡ 550MHzï¼Œ128M DDR2 å†…å­˜ï¼Œ128M ROMï¼ŒUSB å¯æ¥ç¡¬ç›˜è¿›è¡Œå…±äº«ï¼Œå¸¦æœ‰ wifi å¼€å…³æŒ‰é’®å¯ä»¥å•ç‹¬å…³é—­æ— çº¿ä¿¡å·ã€‚

```
Version        v1                
CPU            Atheros AR9344 rev2 560MHz MIPS 74Kc V4.12
Ram            128MiB
Flash        128MiB NAND
Network        1 WAN + 4x LAN (GBit)
Wireless    AR9580 [an 3x3:3] + AR9344 [bgn 2x2:2]
USB            Yes 
```

## å¦‚ä½•è´­ä¹°ç½‘ä»¶ Netgear WNDR4300 æ— çº¿è·¯ç”±å™¨

ç›®å‰è‡ªè¥ç”µå•†çš„ä»·æ ¼ä¸€èˆ¬æ˜¯ 299 å…ƒï¼ŒTB ä»·å¤§çº¦ 280 å…ƒã€‚

## å‚è€ƒä¿¡æ¯

*   [Netgear WNDR4300 OpenWrt å®˜ç½‘ Wiki](https://wiki.openwrt.org/toh/netgear/wndr4300)
*   [Windows ä¸‹ Netgear WNDR4300 åˆ· OpenWrt å›ºä»¶ PDF æ•™ç¨‹ by ä¹¦æµ…](https://software-download.name/2015/netgear-wndr4300-shua-openwrt/)
*   [gy408 é¢„ç¼–è¯‘é›†æˆå›ºä»¶ for WNDR4300](https://github.com/gygy/gygy.github.io)

* * *

#### æœ€ç®€å•çš„è·¯ç”±å™¨åˆ· OpenWrt å›ºä»¶ğŸªœğŸ§±æ•™ç¨‹:

[`github.com/softwaredownload/openwrt-fanqiang`](https://github.com/softwaredownload/openwrt-fanqiang "æœ€ç®€å•çš„è·¯ç”±å™¨åˆ· OpenWrt å›ºä»¶ğŸªœğŸ§±æ•™ç¨‹")

#### åœ¨çº¿é˜…è¯» OpenWrt ğŸªœğŸ§±è·¯ç”±å™¨æ•™ç¨‹:

[`www.gitbook.com/book/softwaredownload/openwrt-fanqiang/details`](https://www.gitbook.com/book/softwaredownload/openwrt-fanqiang/details)

# WNDR4300 ä¸‹è½½å’Œè®¾ç½® Image Builder

# ä¸‹è½½å’Œè®¾ç½® OpenWrt Image Builder for ç½‘ä»¶ Netgear WNDR4300 è·¯ç”±å™¨

ä¸‹è½½ OpenWrt ImageBuilder æ—¶æœ‰äºŒç§é€‰æ‹©ï¼šç¨³å®šå‘è¡Œç‰ˆå’Œæœ€æ–° trunk ç‰ˆã€‚

## ã€€OpenWrt ImageBuilder for ç½‘ä»¶ Netgear WNDR4300 ç¨³å®šå‘è¡Œç‰ˆçš„ä¸‹è½½

è¿›å…¥ç½‘å€ï¼š [`downloads.openwrt.org/`](http://downloads.openwrt.org/)

ç°åœ¨æ˜¯ 2015 å¹´ 12 æœˆ 22 æ—¥ï¼Œå¯ä»¥çœ‹åˆ°ï¼š

> Chaos Calmer 15.05
> Released: Fri, 11 Sep 2015

WNDR4300 æ˜¯ NAND å†…å­˜ï¼Œè¿›å…¥ä¸‹é¢çš„ç½‘å€ä¸‹è½½é€‚åˆ WNDR4300 çš„ ImageBuilder ç¨³å®šå‘è¡Œç‰ˆ:

[`downloads.openwrt.org/chaos_calmer/15.05/ar71xx/nand/`](http://downloads.openwrt.org/chaos_calmer/15.05/ar71xx/nand/)

æˆ‘å°è¯•ç”¨ç¨³å®šå‘è¡Œç‰ˆç¼–è¯‘è‡ªåŠ¨ğŸªœğŸ§±å›ºä»¶ï¼Œå‡ºç°é”™è¯¯ï¼Œåæ¥æ”¹ç”¨ trunk ç‰ˆå°±é¡ºåˆ©æˆåŠŸäº†ã€‚æœ¬æ•™ç¨‹ç”¨çš„æ˜¯ trunk ç‰ˆã€‚

## OpenWrt ImageBuilder for ç½‘ä»¶ Netgear WNDR4300 æœ€æ–° trunk ç‰ˆçš„ä¸‹è½½

Linux ä¸‹ï¼Œä¸‹è½½å·¥å…·ä¸€èˆ¬é»˜è®¤ä¿å­˜åˆ° ~/Downloadsï¼Œå·¥ä½œåœ¨ Downloads ç›®å½•ï¼Œä¸‹è½½ï¼Œè§£å‹å’Œç¼–è¯‘ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ã€‚

```
cd ~/Downloads
wget http://downloads.openwrt.org/snapshots/trunk/ar71xx/nand/OpenWrt-ImageBuilder-ar71xx-nand.Linux-x86_64.tar.bz2
tar -xjf OpenWrt-ImageBuilder-ar71xx-nand.Linux-x86_64.tar.bz2 
```

## ç½‘ä»¶ Netgear WNDR4300 è·¯ç”±å™¨å®Œå…¨ä½¿ç”¨ 128ï¼­å†…å­˜æ•™ç¨‹

å°† ubi å’Œ firmware å¢åŠ  96Mï¼Œå®Œå…¨ä½¿ç”¨ 128M flash,ä»¥å®ç° WNDR4300 è·¯ç”±å™¨ overlay åˆ†åŒºå¤§äº 90MB çš„åŠŸèƒ½

åœ¨ linux ä¸‹ç”¨ vi å‘½ä»¤å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æŸ¥æ‰¾å’Œä¿®æ”¹ç‰¹å®šå­—ç¬¦ã€‚

*   æŸ¥æ‰¾ 23552kï¼Œæ›¿æ¢æˆ 121856k
*   æŸ¥æ‰¾ 25600kï¼Œæ›¿æ¢æˆ 123904k

ä¸‹é¢å°±ç”¨ vi æ¥ä¿®æ”¹ï¼š

```
cd ~/Downloads/OpenWrt-ImageBuilder-ar71xx-nand.Linux-x86_64/target/linux/ar71xx/image
cp Makefile Makefile.bak

vi Makefile

#change ubi size to 121856k    
# search
/23552k
# delete word
dw
# insert
i
121856k

#change firmware size to 123904k
/25600k
dw
i
123904k

#Save and exit
ZZ 
```

ä¿®æ”¹å¥½åæ˜¯è¿™æ ·çš„ï¼š

![](img/1.modifiy-firmware-space.png)

## ç¡®å®šç½‘ä»¶ Netgear WNDR4300 è·¯ç”±å™¨çš„ PROFILE å€¼

```
cd OpenWrt-ImageBuilder-ar71xx-nand.Linux-x86_64
make info 
```

ä¸‹å›¾æœ€ä¸Šé¢ä¸€è¡Œæ˜¾ç¤ºï¼ŒPROFILE å€¼æ˜¯ WNDR4300ï¼š

![](img/1.profile-netgear-wndr4300.png)

## ç¡®å®šåº”è¯¥åŒ…å«åœ¨è‡ªç¼–è¯‘ WNDR4300 è·¯ç”±å™¨ğŸªœğŸ§±å›ºä»¶é‡Œçš„åŒ…

### 1\. åœ¨ Linux ä¸‹è¿è¡Œå‘½ä»¤è‡ªåŠ¨è·å–åŸºç¡€åŒ…ï¼š

```
echo $(wget -qO - http://downloads.openwrt.org/snapshots/trunk/ar71xx/nand/config | sed -ne 's/^CONFIG_PACKAGE_\([a-z0-9-]*\)=y/\1/ip') 
```

ç»“æœå¦‚ä¸‹ï¼š

> base-files busybox dnsmasq dropbear firewall fstools jsonfilter libc libgcc mtd netifd opkg procd swconfig ubox ubus ubusd uci usign kmod-lib-crc-ccitt kmod-ip6tables kmod-ipt-conntrack kmod-ipt-core kmod-ipt-nat kmod-nf-conntrack kmod-nf-conntrack6 kmod-nf-ipt kmod-nf-ipt6 kmod-nf-nat kmod-ipv6 kmod-ppp kmod-pppoe kmod-pppox kmod-slhc kmod-gpio-button-hotplug kmod-spi-bitbang kmod-spi-gpio kmod-ath kmod-ath9k kmod-ath9k-common kmod-cfg80211 kmod-mac80211 libip4tc libip6tc libxtables libblobmsg-json libexpat libiwinfo libjson-c libnl-tiny libubox libubus libuci ip6tables iptables hostapd-common iw odhcp6c odhcpd ppp ppp-mod-pppoe wpad-mini iwinfo jshn libjson-script procd-nand ubi-utils uboot-envtools

### 2\. è·å–ç½‘ä»¶ Netgear WNDR4300 è·¯ç”±å™¨ç›¸å…³åŒ…ï¼š

```
make info
Current Target: "ar71xx (Generic devices with NAND flash)"
Default Packages: base-files libc libgcc busybox dropbear mtd uci opkg netifd fstools kmod-gpio-button-hotplug swconfig kmod-ath9k wpad-mini uboot-envtools dnsmasq iptables ip6tables ppp ppp-mod-pppoe firewall odhcpd odhcp6c
Available Profiles:
...
WNDR4300:
    NETGEAR WNDR3700v4/WNDR4300
    Packages: kmod-usb-core kmod-usb-ohci kmod-usb2 kmod-ledtrig-usbdev 
```

é‚£å°±å†å¢åŠ ä¸Šé¢çš„ Default Packages å’Œ WNDR4300 Packagesã€‚å»é‡æ’åºåï¼Œå†å»æ‰ dnsmasqï¼Œ

### 3\. å¢åŠ è‡ªå®šä¹‰åŒ…

```
ipset wget libopenssl shadowsocks-libev luci-ssl iptables-mod-nat-extra bind-dig dnsmasq-full 
```

Dnsmasq æä¾› DNS ç¼“å­˜å’Œ DHCP æœåŠ¡åŠŸèƒ½ã€‚ä½œä¸ºåŸŸåè§£ææœåŠ¡å™¨(DNS)ï¼Œdnsmasq å¯ä»¥é€šè¿‡ç¼“å­˜ DNS è¯·æ±‚æ¥æé«˜å¯¹è®¿é—®è¿‡çš„ç½‘å€çš„è¿æ¥é€Ÿåº¦ã€‚ä½œä¸º DHCP æœåŠ¡å™¨ï¼Œdnsmasq å¯ä»¥ä¸ºå±€åŸŸç½‘ç”µè„‘æä¾›å†…ç½‘ ip åœ°å€å’Œè·¯ç”±ã€‚

é»˜è®¤çš„ dnsmasq ä¸º base ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä¸èƒ½å¯¹ç‰¹å®šçš„åŸŸååœ°å€è¿›è¡Œæ ‡è®°æ“ä½œï¼ˆå› ä¸ºæˆ‘ä»¬éœ€è¦å¯¹ä¸€äº›ç‰¹å®šåŸŸåå¦‚ twitter ç­‰è¿›è¡Œæ ‡è®°ï¼‰ï¼Œæ”¹ä¸ºæ›´åŠ å¼ºå¤§çš„ dnsmasq-full

luci-ssl æ˜¯ç”¨æ¥ç½‘é¡µç•Œé¢ç®¡ç†è·¯ç”±å™¨ï¼Œå®‰è£…åå°±å¯ä»¥ã€€[`192.168.1.1`](https://192.168.1.1) ç™»å½• WNDR4300 è·¯ç”±å™¨

bind-dig å¯ä»¥è°ƒè¯•åŸŸåè§£æ

shadowsocks-libevã€€ğŸªœğŸ§±ä¸»è§’

# WNDR4300 ç¼–è¯‘ shadowsocks-libev ipk

# ç¼–è¯‘ shadowsocks-libev ipk for ç½‘ä»¶ Netgear WNDR4300 è·¯ç”±å™¨

ä¸åŒ OpenWrt ç‰ˆæœ¬ä¸‹ç¼–è¯‘çš„ shadowsocks-libev ipk ä¸€èˆ¬æ˜¯ä¸èƒ½é€šç”¨çš„ã€‚æ¯”å¦‚ç°åœ¨ç”¨çš„æ˜¯ trunk ç‰ˆçš„ OpenWrtï¼Œå¦‚æœä½¿ç”¨ OpenWrt Chaos Calmer 15.05 ä¸‹ç¼–è¯‘çš„ shadowsocks-libevï¼Œå¯èƒ½å®‰è£…åæ ¹æœ¬ä¸èƒ½å¯åŠ¨ã€‚

å‰é¢æˆ‘æ›¾ç¼–è¯‘å‡ºğŸªœğŸ§±å›ºä»¶ï¼Œå…¶ä¸­ shadowsocks-libev æ˜¯åˆ«äººç¼–è¯‘ï¼Œä» sourceforge ä¸Šä¸‹è½½çš„ï¼Œåˆ·ä¸Šå›ºä»¶åï¼Œshadowsocks æ€»æ˜¯æ²¡æœ‰è‡ªåŠ¨å¯åŠ¨ï¼Œè¿è¡Œ/usr/bin/ss-redirï¼ŒæŠ¥å‘Šæ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œå…¶å®æ–‡ä»¶æ˜¯åœ¨çš„ï¼Œåªæ˜¯ä¸å…¼å®¹ã€‚æ‰€ä»¥ï¼Œæœ€å¥½è¿˜æ˜¯è‡ªè¡Œç¼–è¯‘ shadowsocks-libevã€‚

æŒ‰å®˜ç½‘çš„[è¯´æ³•](https://wiki.openwrt.org/doc/howto/build)ï¼Œä»¥ä¸‹ **ä¸è¦ä½¿ç”¨ root ç”¨æˆ·æ¥æ“ä½œ**

## ç¼–è¯‘ shadowsocks-libev ipk å®‰è£…åŒ…

è¯·åŒæ—¶å‚è€ƒå‰é¢çš„æ•™ç¨‹ï¼šç¼–è¯‘ shadowsocks-libev for OpenWrt ipk å®‰è£…åŒ…

ä¸‹é¢éƒ½æ˜¯åœ¨ Linux ä¸‹æ“ä½œã€‚

```
cd ~/Downloads
git clone git://git.openwrt.org/openwrt.git

pushd package
git clone https://github.com/shadowsocks/shadowsocks-libev.git
popd

cd ~/Downloads/openwrt
./scripts/feeds update -a
./scripts/feeds install -a    

make defconfig
make prereq
make menuconfig            

ï¼ƒ Target System: Atheros AR7xxx/AR9XXX  
ï¼ƒ Subtarget: Generic device with NAND flash
ï¼ƒ Target Profile: (å› æˆ‘ä»¬åªæ˜¯ç¼–è¯‘åŒ…ï¼Œè¿™æ­¥å¯ä»¥ä¸é€‰)
ï¼ƒ Network, é€‰æ‹© shadowsocks-libev-openssl å’Œ shadowsocks-libev-polarssl,  æŒ‰ m è®¾ç½®ä¸ºç¼–è¯‘ç‹¬ç«‹ ipk å®‰è£…åŒ…
ï¼ƒ Save && Exit

#ã€€è¿™ä¸€æ­¥èŠ±äº†å‡ ä¸ªå°æ—¶
make tools/install && make toolchain/install

# å¼€å§‹ç¼–è¯‘
make V=99 package/shadowsocks-libev/openwrt/compile 
```

![](img/2.shadowsocks-libev-ipk-menuconfig.png)

è¾“å‡ºæ–‡ä»¶åœ¨ã€€openwrt/bin/ar71xx/packages/base/ç›®å½•ä¸‹ï¼Œä¸»è¦æœ‰ï¼š

```
shadowsocks-libev_2.4.3_ar71xx.ipk
shadowsocks-libev-polarssl_2.4.3_ar71xx.ipk
libopenssl_1.0.2e-1_ar71xx.ipk
libpolarssl_1.3.15-1_ar71xx.ipk 
```

æŠŠæ‰€æœ‰ ipk éƒ½å¤åˆ¶åˆ° ImageBuilder çš„ packages/base ç›®å½•ä¸‹

```
cd ~/Downloads/openwrt/bin/ar71xx/packages/base/
cp * ~/Downloads/OpenWrt-ImageBuilder-ar71xx-nand.Linux-x86_64/packages/base 
```

# WNDR4300 ä¿®æ”¹ğŸªœğŸ§±é…ç½®æ–‡ä»¶

# è®¾ç½®ç½‘ä»¶ Netgear WNDR4300 ğŸªœğŸ§±é…ç½®æ–‡ä»¶

è¦ğŸªœğŸ§±æˆåŠŸï¼Œè¿™ä¸€æ­¥æ˜¯æœ€é‡è¦çš„ã€‚

åˆ†ä¸‰æ­¥ï¼Œä¸‹è½½æœ¬é¡¹ç›® openwrt-fanqiangï¼›å¤åˆ¶é…ç½®æ–‡ä»¶ï¼›ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚

ä¸‹é¢ä»¥ linux ç³»ç»Ÿ ~/Downloads ä¸‹æ“ä½œä¸ºä¾‹ã€‚

## ä¸‹è½½åŒ…å«é»˜è®¤ğŸªœğŸ§±é…ç½®æ–‡ä»¶çš„ openwrt-fanqiang é¡¹ç›®

*   git ä¸‹è½½ openwrt-fanqiang é¡¹ç›®

    cd ~/Downloads git clone [`github.com/softwaredownload/openwrt-fanqiang`](https://github.com/softwaredownload/openwrt-fanqiang)

*   æˆ–è€…ä¸‹è½½ zip æ–‡ä»¶

    [`github.com/softwaredownload/openwrt-fanqiang/archive/master.zip`](https://github.com/softwaredownload/openwrt-fanqiang/archive/master.zip)

æœ¬åœ°é¡¹ç›®æ–‡ä»¶å¤¹æ˜¯ï¼š ~/Downloads/openwrt-fanqiang

## å¤åˆ¶ openwrt-fanqiang é‡Œé¢çš„ğŸªœğŸ§±é…ç½®æ–‡ä»¶åˆ° openwrt-wndr4300 ç›®å½•ä¸‹

å»ºç«‹ä¸€ä¸ªé…ç½®æ–‡ä»¶å¤¹ï¼Œä»¥è·¯ç”±å™¨å‹å·ç»“æŸï¼Œå¦‚ ~/Downloads/openwrt-wndr4300ã€‚

```
cd ~/Downloads
mkdir openwrt-wndr4300

cd openwrt-fanqiang
cp -R openwrt/default/* ~/Downloads/openwrt-wndr4300/
cp -R openwrt/wndr4300/* ~/Downloads/openwrt-wndr4300/ 
```

ä¸Šé¢çš„æ“ä½œï¼Œå…ˆå¤åˆ¶å…±ç”¨çš„é…ç½®æ–‡ä»¶ openwrt/default/ *åˆ° openwrt-wndr4300 ç›®å½•ä¸‹
ç„¶åå¤åˆ¶ wndr4300 ä¸“ç”¨çš„é…ç½®æ–‡ä»¶åˆ° openwrt/wndr4300/* åˆ° openwrt-wndr4300 ç›®å½•ä¸‹ï¼Œå¦‚æœæœ‰åŒåæ–‡ä»¶å°±è¦†ç›–ã€‚

å¦‚æœä½ è¦è´¡çŒ®æœ¬é¡¹ç›®ï¼Œä¹Ÿæ˜¯å…ˆåœ¨ openwrt-fanqiang/openwrt ç›®å½•ä¸‹å…ˆå»ºç«‹è·¯ç”±å™¨å‹å·ä¸ºåç§°çš„æ–‡ä»¶å¤¹ï¼Œå†æŠŠä¸“ç”¨çš„é…ç½®æ–‡ä»¶æ”¾åˆ°æ­¤æ–‡å¤¹ä¸‹ã€‚æ³¨æ„æ–‡ä»¶å¤¹å’Œæ–‡ä»¶åéƒ½æ˜¯å°å†™çš„ã€‚

## ä¿®æ”¹ Netgear WNDR4300 ğŸªœğŸ§±é…ç½®æ–‡ä»¶

### ä¸»è¦ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶ï¼š

```
openwrt-wndr4300/etc/shadowsocks.json
openwrt-wndr4300/usr/bin/shadowsocks-firewall
openwrt-wndr4300/etc/uci-defaults/defaults 
```

ä¸ºäº†æ–¹ä¾¿ä»¥åå‡çº§ï¼Œå¯ä»¥å†™ä¸ª bash æ–‡ä»¶è‡ªåŠ¨ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚

ä¸€åˆ‡æ“ä½œå°½é‡è‡ªåŠ¨åŒ–ï¼Œä½ ç”šè‡³å¯ä»¥è‡ªåŠ¨åŒ–ä¸€åˆ‡æ“ä½œï¼šä¸‹è½½ ImageBuilderï¼Œä¸‹è½½ OpenWrt æºç ï¼Œä¸‹è½½ shadowsocks-libev æºç ï¼ŒåŒæ­¥ openwrt-fanqiang æºç ï¼Œç¼–è¯‘ ipkï¼Œä¿®æ”¹ğŸªœğŸ§±è®¾ç½®ï¼Œç¼–è¯‘ğŸªœğŸ§±å›ºä»¶ï¼Œæ—©ä¸Šä¸€è§‰é†’æ¥ï¼Œæ–°é²œå‡ºç‚‰ã€ç¾å‘³å¯å£çš„ğŸªœğŸ§±å›ºä»¶å°±å·²ç»æ‘†æ”¾åœ¨æ¡Œä¸Šäº†ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªè‡ªåŠ¨ä¿®æ”¹é…ç½®æ–‡ä»¶çš„ä¾‹å­ï¼Œä»ä¸­å¯ä»¥çŸ¥é“éœ€è¦ä¿®æ”¹å“ªäº›åœ°æ–¹ã€‚ä» 2015 å¹´ 12 æœˆèµ·ï¼Œå¯èƒ½ç”¨äºè‡ªåŠ¨åŒ–ä¿®æ”¹çš„é»˜è®¤å€¼éƒ½åº”è¯¥æ ‡å‡†åŒ–ï¼Œæ–¹ä¾¿è‡ªåŠ¨åŒ–æ“ä½œã€‚

### config-wndr4300.sh:

```
#!/bin/bash

# Author: https://github.com/softwaredownload/openwrt-fanqiang
# Date:   2015-12-20

REPOSITORY=~/Downloads/openwrt-fanqiang
CONFIG=~/Downloads/openwrt-wndr4300

createdir() {
    rm -rf $CONFIG
    mkdir $CONFIG
}

copy() {
    cp -R $REPOSITORY/openwrt/default/* $CONFIG/
    cp -R $REPOSITORY/openwrt/wndr4300/* $CONFIG/
}

setmod() {
    chmod +x $CONFIG/usr/bin/shadowsocks-firewall
    chmod +x $CONFIG/etc/uci-defaults
    chmod +x $CONFIG/etc/uci-defaults/*
}

modify() {
    # server ip address
    sed -i 's/1.0.9.8/server_ip/' $CONFIG/etc/shadowsocks.json

    # server_port
    sed -i 's/1098/server_port/' $CONFIG/etc/shadowsocks.json

    # local_port
    sed -i 's/7654/7654/' $CONFIG/etc/shadowsocks.json

    # password
    sed -i 's/killgfw/killgfw/' $CONFIG/etc/shadowsocks.json

    # method
    sed -i 's/aes-256-cfb/aes-256-cfb/' $CONFIG/etc/shadowsocks.json

    # server ip addresss
    sed -i 's/1.0.9.8/server_ip/' $CONFIG/usr/bin/shadowsocks-firewall

    # local_port
    sed -i 's/7654/7654/' $CONFIG/usr/bin/shadowsocks-firewall

    # ppoe username
    sed -i 's/wan-username/wan-username/' $CONFIG/etc/uci-defaults/defaults

    # ppoe password
    sed -i 's/wan-password/wan-password/' $CONFIG/etc/uci-defaults/defaults

    # wifi password
    sed -i 's/icanfly9876/icanfly9876/g' $CONFIG/etc/uci-defaults/defaults

    # router login password for root
    sed -i 's/\\nfanqiang/\\nfanqiang/' $CONFIG/etc/uci-defaults/defaults
}

if [ "$1" = "createdir" ]; then
    createdir
elif [ "$1" = "copy" ]; then
    copy
elif [ "$1" = "setmod" ]; then
    setmod
elif [ "$1" = "modify" ]; then
    modify
else
    echo "usage: createdir copy setmod modify"
fi 
```

### config-wndr4300.sh ä½¿ç”¨æ–¹æ³•ï¼š

å¿…æ”¹å€¼æ˜¯ï¼š

```
server_ip
wan-username
wan-password 
```

å¦‚æœä½ æ¯”è¾ƒæ‡’ï¼Œå°±æ”¹è¿™ä¸‰é¡¹å°±è¡Œäº†ï¼Œå¯ä»¥è¯´æœ¬æ•™ç¨‹æ˜¯æœ€ç®€å•çš„ğŸªœğŸ§±æ–¹æ¡ˆäº†ã€‚

é€‰æ”¹å€¼ï¼š

```
router login password for root
wifi password 
```

å…¶ä»–å€¼ä¸€èˆ¬ä¿æŒé»˜è®¤å€¼å°±å¯ä»¥äº†ã€‚

å‡è®¾ config-wndr4300.sh åœ¨~/Downloads ç›®å½•ä¸‹ï¼Œè¿è¡Œå‘½ä»¤è‡ªåŠ¨ä¿®æ”¹ğŸªœğŸ§±é…ç½®ï¼š

```
cd ~/Downloads
sudo chmod +x config-wndr4300.sh
./config-wndr4300.sh createdir
./config-wndr4300.sh copy
./config-wndr4300.sh setmod
./config-wndr4300.sh modify 
```

# WNDR4300 ç¼–è¯‘è‡ªåŠ¨ğŸªœğŸ§±å›ºä»¶

# ç¼–è¯‘ OpenWrt è‡ªåŠ¨ğŸªœğŸ§±å›ºä»¶ for ç½‘ä»¶ Netgear WNDR4300 è·¯ç”±å™¨

ç»è¿‡å‰é¢å‡ ä¸ªæ­¥éª¤ï¼Œä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼Œä¸‹é¢å°±æ­£ç¡®å¼€å§‹ç¼–è¯‘ Netgear WNDR4300 ä¸“ç”¨å…¨è‡ªåŠ¨ğŸªœğŸ§±å›ºä»¶äº†ã€‚

## ç¼–è¯‘ OpenWrt è‡ªåŠ¨ğŸªœğŸ§±å›ºä»¶å‰çš„ç³»ç»Ÿå‡†å¤‡

```
sudo apt-get update
sudo apt-get install git-core build-essential libssl-dev libncurses5-dev unzip 
```

## OpenWrt Image Builder çš„ä¸‰ä¸ªå‘½ä»¤è¡Œå‚æ•°

*   PROFILE æŒ‡å®šè®¾å¤‡ç±»å‹ï¼Œæ­¤å¤„æ˜¯ã€€WNDR4300
*   PACKAGES æŒ‡å®šè¦ç¼–è¯‘è¿›å›ºä»¶çš„åŒ…
*   FILES æŒ‡å®šè¦ç¼–è¯‘è¿›å›ºä»¶çš„è‡ªå®šä¹‰æ–‡ä»¶ï¼Œå¦‚ç½‘ç»œæœ‰å…³é…ç½®æ–‡ä»¶, é»˜è®¤ç›®å½•ï¼š~/Downloads/openwrt-wndr4300

## å¼€å§‹ç¼–è¯‘ OpenWrt è‡ªåŠ¨ğŸªœğŸ§±å›ºä»¶ for ç½‘ä»¶ Netgear WNDR4300 è·¯ç”±å™¨

å‘½ä»¤ï¼š

```
cd ~/Downloads/OpenWrt-ImageBuilder-ar71xx-nand.Linux-x86_64/

make image PROFILE=WNDR4300 PACKAGES="base-files busybox dropbear firewall fstools jsonfilter libc libgcc mtd netifd opkg procd swconfig ubox ubus ubusd uci usign kmod-lib-crc-ccitt kmod-ipv6 kmod-ip6tables kmod-ipt-conntrack kmod-ipt-core kmod-ipt-nat kmod-nf-conntrack kmod-nf-conntrack6 kmod-nf-ipt kmod-nf-ipt6 kmod-nf-nat kmod-ppp kmod-pppoe kmod-pppox kmod-slhc kmod-gpio-button-hotplug kmod-spi-bitbang kmod-spi-gpio kmod-ath kmod-ath9k kmod-ath9k-common kmod-cfg80211 kmod-mac80211 libip4tc libip6tc libxtables libblobmsg-json libexpat libiwinfo libjson-c libnl-tiny libubox libubus libuci ip6tables iptables hostapd-common iw odhcp6c odhcpd ppp ppp-mod-pppoe wpad-mini iwinfo jshn libjson-script procd-nand ubi-utils uboot-envtools base-files libc libgcc busybox dropbear mtd uci opkg netifd fstools kmod-gpio-button-hotplug swconfig kmod-ath9k wpad-mini uboot-envtools kmod-usb-core kmod-usb-ohci kmod-usb2 kmod-ledtrig-usbdev ipset wget libopenssl shadowsocks-libev luci-ssl iptables-mod-nat-extra bind-dig dnsmasq-full" FILES=~/Downloads/openwrt-wndr4300 
```

ç¼–è¯‘æ—¶æŠ¥é”™ï¼š

> opkg_install_cmd: Cannot install package kmod-ipv6

ç§»é™¤ kmod-ipv6 åç¼–è¯‘æˆåŠŸã€‚

ç¼–è¯‘å¥½çš„çš„å›ºä»¶åœ¨ï¼š

```
~/Downloads/OpenWrt-ImageBuilder-ar71xx-nand.Linux-x86_64/bin/ar71xx/ 
```

å…¶ä¸­åŒ…å«ï¼š

```
openwrt-ar71xx-nand-wndr4300-ubi-factory.img
openwrt-ar71xx-nand-wndr4300-squashfs-sysupgrade.tar 
```

å¯è§ç”Ÿæˆäº†äºŒç§æ ¼å¼çš„å›ºä»¶ï¼Œimg æ ¼å¼å’Œ tar æ ¼å¼ã€‚ å…¶ä¸­ img æ ¼å¼åªèƒ½ç”¨ tftp çš„æ–¹æ³•è¿›è¡Œåˆ·å…¥ã€‚è€Œ tar ä¹Ÿåªèƒ½é€šè¿‡ å·²åˆ·äº† Openwrt çš„ WEB ç«¯è¿›è¡Œåˆ·å…¥ã€‚

### éƒ¨åˆ†ç¼–è¯‘é”™è¯¯å¤„ç†

1.  Build dependency: Please install the openssl library (with development headers)

    For Centosï¼š

    ```
     yum install openssl-devel 
    ```

    For Ubuntuï¼š

    ```
     sudo apt-get install libssl-dev 
    ```

2.  Unable to open feeds configuration in line 42

    ä½¿ç”¨ `svn co svn://svn.openwrt.org/openwrt/trunk/` ä¸‹è½½åå†ç¼–è¯‘çš„æ–¹æ³•æ²¡æœ‰é‡åˆ°è¿™ä¸ªé—®é¢˜ã€‚

3.  configure: error: you should not run configure as root (set FORCE_UNSAFE_CONFIGURE=1 in environment to bypass this check)

    See config.log' for more details

    å°†ä¸‹è½½çš„æ–‡ä»¶çš„æ‰€æœ‰è€…æ”¹ä¸ºè‡ªå·±,å‡è®¾ç”¨æˆ·åæ˜¯ ubuntu

    `sudo chown -Rv ubuntu /home/ubuntu/openwrt`

    å†é‡æ–°è¿è¡Œ`make`

# WNDR4300 æ€æ ·åˆ·è‡ªåŠ¨ğŸªœğŸ§±å›ºä»¶

# ç½‘ä»¶ Netgear WNDR4300 è·¯ç”±å™¨æ€æ ·åˆ· OpenWrt è‡ªåŠ¨ğŸªœğŸ§±å›ºä»¶

## ä¸¤ç§ğŸªœğŸ§±å›ºä»¶æ ¼å¼ img tar çš„åŒºåˆ«

```
openwrt-ar71xx-nand-wndr4300-ubi-factory.img
openwrt-ar71xx-nand-wndr4300-squashfs-sysupgrade.tar 
```

æˆ‘ä»¬ç¼–è¯‘å‡ºäº†ä¸¤ç§å›ºä»¶ï¼Œä¸€ç§ä¸º ...ubi-factory.img æ ¼å¼ï¼Œä¸€ç§ä¸º ...squashfs-sysupgrade.tar æ ¼å¼ã€‚ å…¶ä¸­ img æ ¼å¼åªèƒ½ç”¨ tftp çš„æ–¹æ³•åˆ·å…¥ã€‚è€Œ tar åªèƒ½é€šè¿‡å·²åˆ·äº† Openwrt çš„ WEB ç«¯è¿›è¡Œåˆ·å…¥ã€‚ä¸‹é¢åˆ†åˆ«è¯´æ˜ ä¸¤ç§ä¸åŒçš„åˆ·å…¥æ–¹æ³•ï¼š

tftp åˆ·å›ºä»¶çš„æ–¹å¼ï¼Œä¸ç®¡åŸæ¥çš„å›ºä»¶æ˜¯ä»€ä¹ˆæ ¼å¼ï¼Œéƒ½å¯ä»¥åˆ· factory.img

## ç½‘ä»¶ Netgear WNDR4300 è·¯ç”±å™¨è¿›å…¥æ¢å¤æ¨¡å¼çš„æ–¹æ³•

*   å…³é—­è·¯ç”±å™¨ç”µæº
*   ç”¨ ç‰™ç­¾ï¼Œæˆ–å…¶ä»–å°–ç‰© æŒ‰ä½è®¾å¤‡èƒŒé¢çš„æœºèº«èƒŒé¢çš„çº¢è‰²å°åœ†å­”(Restore Factory Settings button)
*   å¼€å¯ç”µæºå¼€å…³
*   è§‚å¯Ÿç”µæºç¯ï¼ˆæ­¤æ—¶ä¿æŒæŒ‰ä½ Restore Factory Settings æŒ‰é’®ä¸è¦æ¾æ‰‹ï¼‰ï¼Œç›´åˆ°ç”µæºç¯ç”± æ©™è‰²é—ªçƒ çŠ¶æ€å˜åˆ° ç»¿è‰²é—ªçƒ çŠ¶æ€ï¼ˆè¯´æ˜è®¾å¤‡å·²ç»è¿›å…¥åˆ°äº† TFTP ä¿®å¤æ¨¡å¼ ï¼‰

## Linux ä¸‹ Netgear WNDR4300 è·¯ç”±å™¨ç”¨ tftp åˆ·ğŸªœğŸ§±å›ºä»¶

*   å°†ç”µè„‘ç”¨ç½‘çº¿è¿æ¥åˆ°è®¾å¤‡çš„ LAN å£ï¼Œè€Œä¸æ˜¯ wan å£ã€‚å›½è¡Œ Netgear WNDR4300 çš„ wan å£æ˜¯é»„è‰²çš„
*   å°†ç”µè„‘çš„æœ¬åœ°è¿æ¥ IP è®¾ç½®ä¸º 192.168.1.X ï¼ˆæ­¤ä¾‹ä¸­ IP åœ°å€è®¾ç½®ä¸º 192.168.1.2 ï¼‰ï¼Œå­ç½‘æ©ç ä¸º 255.255.255.0ï¼Œç½‘å…³ä¸º 192.168.1.1
*   è·¯ç”±å™¨è¿›å…¥æ¢å¤æ¨¡å¼
*   æµ‹è¯•èƒ½å¦è¿æ¥åˆ°è·¯ç”±å™¨ï¼š

    ```
     ping 192.168.1.1
      PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data.
      Warning: time of day goes back (-3646479862160196504us), taking countermeasures.
      Warning: time of day goes back (-3646479862160196420us), taking countermeasures. 
    ```

*   ç½‘ä»¶ Netgear WNDR4300 è·¯ç”±å™¨åˆ·ğŸªœğŸ§±å›ºä»¶

    ```
     sudo apt-get install tftp
      #ã€€è¿›å…¥å›ºä»¶æ‰€åœ¨ç›®å½•
      cd ~/Downloads/OpenWrt-ImageBuilder-ar71xx-nand.Linux-x86_64/bin/ar71xx
      echo -e "binary\nrexmt 1\ntimeout 60\ntrace\nput openwrt-ar71xx-nand-wndr4300-ubi-factory.img\n" | tftp 192.168.1.1 
    ```

*   è§‚å¯ŸæŒ‡ç¤ºç¯ï¼Œæ–‡ä»¶ä¼ é€å®Œæ¯•åï¼Œç­‰å¾… 80 ç§’å·¦å³ï¼Œè®¾å¤‡ä¼šè‡ªåŠ¨é‡å¯ï¼ˆè¯·è€å¿ƒç­‰å¾…ï¼Œåˆ‡å‹¿å°†è·¯ç”±å™¨æ‰‹åŠ¨æ–­ç”µï¼‰ã€‚è®¾å¤‡é‡å¯åï¼Œçœ‹åˆ°äº®ç»¿ç¯ï¼Œä¸€å®šè¦æŒ‰æœºèº«åé¢çš„ç”µæºå¼€å…³æ‰‹åŠ¨æ–­ç”µã€å¼€æœºï¼Œå¦åˆ™å¯èƒ½æ²¡æœ‰æ— çº¿ 5G è¿™ä¸æ˜¯ BUGï¼Œå…¶ä»– openwrt ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚æ¯æ¬¡åˆ· factory.img éƒ½è¦è¿™æ ·

## Windows ä¸‹ Netgear WNDR4300 è·¯ç”±å™¨ç”¨ tftp åˆ·ğŸªœğŸ§±å›ºä»¶

*   å¯ç”¨ tftpã€‚Windows 10 ä¸‹ï¼šæ§åˆ¶é¢æ¿ï¼Œæ‰€æœ‰æ§åˆ¶é¢æ¿é¡¹ï¼Œç¨‹åºå’ŒåŠŸèƒ½ï¼Œå¯ç”¨æˆ–å…³é—­ Windows åŠŸèƒ½ï¼Œå¯ç”¨â€œTFTPâ€å®¢æˆ·ç«¯
*   å°†ç”µè„‘ç”¨ç½‘çº¿è¿æ¥åˆ°è®¾å¤‡çš„ LAN å£
*   å°†ç”µè„‘çš„æœ¬åœ°è¿æ¥ IP è®¾ç½®ä¸º 192.168.1.X ï¼ˆæ­¤ä¾‹ä¸­ IP åœ°å€è®¾ç½®ä¸º 192.168.1.2 ï¼‰ï¼Œå­ç½‘æ©ç ä¸º 255.255.255.0ï¼Œç½‘å…³ 192.168.1.1
*   è·¯ç”±å™¨è¿›å…¥æ¢å¤æ¨¡å¼
*   æµ‹è¯•èƒ½å¦è¿æ¥åˆ°è·¯ç”±å™¨ï¼š ping 192.168.1.1
*   ç½‘ä»¶ Netgear WNDR4300 è·¯ç”±å™¨åˆ·ğŸªœğŸ§±å›ºä»¶

    *   æŒ‰ Windows+R,è¾“å…¥ cmd å¹¶å›è½¦è°ƒå‡ºå‘½ä»¤è¡Œç¨‹åº
    *   å‡è®¾ openwrt-ar71xx-nand-wndr3700v4-ubi-factory.img åœ¨ C:\ç›˜
    *   è¿è¡Œå‘½ä»¤ï¼š

        ```
   cd C:\
          tftp -i 192.168.1.1 put openwrt-ar71xx-nand-wndr3700v4-ubi-factory.img 
        ```

        ![netgear wndr4300 shua openwrt fanqiang gujian](img/5.tftp-flash-fanqiang-img-windows.png)

*   è§‚å¯ŸæŒ‡ç¤ºç¯ï¼Œè®¾å¤‡é‡å¯åï¼Œçœ‹åˆ°äº®ç»¿ç¯ï¼Œå†æ‰‹åŠ¨æ–­ç”µã€å¼€æœºï¼Œå¦åˆ™å¯èƒ½æ²¡æœ‰æ— çº¿ 5G

æ›´è¯¦ç»†çš„ WNDR4300 åˆ· openwrt PDF å›¾æ–‡æ•™ç¨‹ï¼š
[Windows ä¸‹ Netgear WNDR4300 åˆ· OpenWrt å›ºä»¶ PDF æ•™ç¨‹ by ä¹¦æµ…](https://software-download.name/2015/netgear-wndr4300-shua-openwrt/)

# WNDR4300 ç™»å½•å¹¶è®¾ç½®ğŸªœğŸ§±å›ºä»¶

# ç™»å½•å¹¶è®¾ç½®å·²ç»åˆ·äº† OpenWrt ğŸªœğŸ§±å›ºä»¶çš„ç½‘ä»¶ Netgear WNDR4300 è·¯ç”±å™¨

## Netgear WNDR4300 é¢„ç¼–è¯‘ğŸªœğŸ§±å›ºä»¶ä¸‹è½½(2015-12-22)

[`software-download.name/2015/netgear-wndr4300-openwrt-fanqiang-gujian/`](https://software-download.name/2015/netgear-wndr4300-openwrt-fanqiang-gujian/)

ä½ æŒ‰ç…§[æœ¬æ•™ç¨‹](https://github.com/softwaredownload/openwrt-fanqiang)ç¼–è¯‘äº† WNDR4300 è·¯ç”±å™¨ OpenWrt å…¨è‡ªåŠ¨ğŸªœğŸ§±å›ºä»¶ï¼Œå¹¶ä¸”åˆ·è¿›äº†è·¯ç”±å™¨ï¼Œå¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œå°±å¯ä»¥é›¶è®¾ç½®è‡ªåŠ¨ğŸªœğŸ§±äº†ã€‚è¿æ°”ä¸å¤Ÿå¥½ï¼Œå°±è¦ç™»å½•è·¯ç”±å™¨ä¿®æ”¹ä¸€ä¸‹è®¾ç½®ã€‚

ä½ æ‡¶å¾—è‡ªå·±ç¼–è¯‘ğŸªœğŸ§±å›ºä»¶ï¼Œä¸‹è½½äº†æœ¬æ•™ç¨‹æä¾›çš„ Netgear WNDR4300 è·¯ç”±å™¨ğŸªœğŸ§±å›ºä»¶å¹¶åˆ·è¿›äº†è·¯ç”±å™¨ï¼Œå°±å¿…é¡»æ‰‹åŠ¨ä¿®æ”¹ä¸€äº›å€¼æ‰èƒ½è‡ªåŠ¨ğŸªœğŸ§±ã€‚

æœ¬æ•™ç¨‹å°±é’ˆå¯¹ä¸Šé¢è¿™ä¸¤ç§æƒ…å†µã€‚

## æ€æ ·ç™»å½•å·²ç»åˆ·äº† OpenWrt ğŸªœğŸ§±å›ºä»¶çš„ç½‘ä»¶ Netgear WNDR4300 è·¯ç”±å™¨

ç”¨ç½‘çº¿è¿æ¥ç”µè„‘å’Œè·¯ç”±å™¨ï¼Œå°†ç”µè„‘çš„æœ¬åœ°è¿æ¥ IP è®¾ç½®ä¸º 192.168.1.2ï¼Œå­ç½‘æ©ç ä¸º 255.255.255.0ï¼Œç½‘å…³ä¸ºï¼š192.168.1.1

*   ç½‘é¡µç™»å½•åœ°å€ï¼š [`192.168.1.1`](https://192.168.1.1)
*   ssh ç™»å½•ï¼šã€€root @192.168.1.1
*   é»˜è®¤ç™»å½•å¯†ç ï¼š fanqiang

## Linux ä¸‹ ssh ç™»å½• WNDR4300 è·¯ç”±å™¨å¹¶ä¿®æ”¹è®¾ç½®

```
eastking@ubuntu:~$ ssh root@192.168.1.1
root@192.168.1.1's password: 
BusyBox v1.24.1 (2015-12-18 16:02:57 CET) built-in shell (ash)

Author:
https://github.com/softwaredownload/openwrt-fanqiang

# server_ip
root@OpenWrt:~# vi /etc/shadowsocks.json

# server_ip
root@OpenWrt:~# vi /usr/bin/shadowsocks-firewall

# wan-username, wan-password
root@OpenWrt:~# vi /etc/config/network

# wifi password, optional
root@OpenWrt:~# vi /etc/config/wireless 
```

å¦‚æœä½ ä¿®æ”¹äº†æœ¬æ•™ç¨‹é»˜è®¤çš„ shadowsocks local_port å’Œ tunnel_portï¼Œè¿˜å¾—ä¿®æ”¹/etc/dnsmasq.d/ä¸‹ç›¸å…³æ–‡ä»¶ä¸­çš„ç«¯å£å·ã€‚

## æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä½¿ä¿®æ”¹ç”Ÿæ•ˆ

```
root@OpenWrt:~# /etc/init.d/shadowsocks stop
root@OpenWrt:~# /etc/init.d/shadowsocks start
root@OpenWrt:~# /etc/init.d/dnsmasq restart
root@OpenWrt:~# /etc/init.d/network restart 
```